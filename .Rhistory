geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 12 in different years")
ggsave(filename="reprod_contour_p_t_12.png",plot=interp_p_hats_12_t,width=12,height=9)
interp_p_hats_15_t<-ggplot(pred_all_15_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 15 in different years")
ggsave(filename="reprod_contour_p_t_15.png",plot=interp_p_hats_15_t,width=12,height=9)
interp_p_hats_20_t<-ggplot(pred_all_20_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 20 in different years")
ggsave(filename="reprod_contour_p_t_20.png",plot=interp_p_hats_20_t,width=12,height=9)
hist(subset(pred_all_t_9,split==1)$var1.pred-subset(pred_all_t_9,split==2)$var1.pred)
hist(subset(pred_all_9_t,split==1)$var1.pred-subset(pred_all_9_t,split==2)$var1.pred)
splits
splits==1
splits=1
temp_sf_p_hats_9<-st_as_sf(subset(p_hat_frame,type==9 & splits==splits),coords=c("x","y"))
head(temp_sf_p_hats_9)
temp_sf_p_hats_9<-st_as_sf(subset(p_hat_frame,type==9 & splits==2),coords=c("x","y"))
head(p_hat_frame)
head(p_hats_t)
for (splits in 1:3){
sub_temp_data<-subset(sub_data,split==splits)
sub_temp_data$spoligotype<-as.numeric(sub_temp_data$spoligotype)
sub_temp_data$spoligotype[which(sub_temp_data$spoligotype==9)]<-1
sub_temp_data$spoligotype[which(sub_temp_data$spoligotype==12)]<-2
sub_temp_data$spoligotype[which(sub_temp_data$spoligotype==15)]<-3
sub_temp_data$spoligotype[which(sub_temp_data$spoligotype==20)]<-4
blep3<-p_hats_int_fn(sub_locations,st_coordinates(sub_temp_data),sub_temp_data$spoligotype,6080)
temp_hats_t<-data.frame(x=rep(st_coordinates(sub_data)[,1],4),y=rep(st_coordinates(sub_data)[,2],4),splits=rep(splits,nrow(sub_data)*4),p_hats=c(blep3[,1],blep3[,2],blep3[,3],blep3[,4]))
if (splits==1) p_hats_t<-temp_hats_t
else p_hats_t<-rbind(p_hats_t,temp_hats_t)
}
head(p_hats_t)
dim(blep3)
for (splits in 1:3){
sub_temp_data<-subset(sub_data,split==splits)
sub_temp_data$spoligotype<-as.numeric(sub_temp_data$spoligotype)
sub_temp_data$spoligotype[which(sub_temp_data$spoligotype==9)]<-1
sub_temp_data$spoligotype[which(sub_temp_data$spoligotype==12)]<-2
sub_temp_data$spoligotype[which(sub_temp_data$spoligotype==15)]<-3
sub_temp_data$spoligotype[which(sub_temp_data$spoligotype==20)]<-4
blep3<-p_hats_int_fn(sub_locations,st_coordinates(sub_temp_data),sub_temp_data$spoligotype,6080)
temp_hats_t<-data.frame(x=rep(st_coordinates(sub_data)[,1],4),y=rep(st_coordinates(sub_data)[,2],4),splits=rep(splits,nrow(sub_data)*4),p_hats=c(blep3[,1],blep3[,2],blep3[,3],blep3[,4]),type=rep(c(9,12,15,20),each=nrow(blep3)))
if (splits==1) p_hats_t<-temp_hats_t
else p_hats_t<-rbind(p_hats_t,temp_hats_t)
}
head(p_hats_t)
for (splits in 1:3){
#Make sf frame
temp_sf_p_hats_9<-st_as_sf(subset(p_hats_t,type==9 & splits==splits),coords=c("x","y"))
temp_sf_p_hats_12<-st_as_sf(subset(p_hat_frame,type==12 & splits==splits),coords=c("x","y"))
temp_sf_p_hats_15<-st_as_sf(subset(p_hat_frame,type==15 & splits==splits),coords=c("x","y"))
temp_sf_p_hats_20<-st_as_sf(subset(p_hat_frame,type==20 & splits==splits),coords=c("x","y"))
temp_pred_mod_9<-gstat(formula=p_hats~1, data=temp_sf_p_hats_9)
temp_pred_mod_12<-gstat(formula=p_hats~1, data=temp_sf_p_hats_12)
temp_pred_mod_15<-gstat(formula=p_hats~1, data=temp_sf_p_hats_15)
temp_pred_mod_20<-gstat(formula=p_hats~1, data=temp_sf_p_hats_20)
#intersect
temp_inter_9<-st_intersects(temp_sf_p_hats_9,final_grid)
final_grid$p_hats<-rep(NA,nrow(final_grid))
final_grid$p_hats[unlist(temp_inter_9)]<-temp_sf_p_hats_9$p_hats
temp_pred_all_9<-predict(temp_pred_mod_9,final_grid)
temp_pred_all_9$split<-rep(splits,nrow(temp_pred_all_9))
#intersect
temp_inter_12<-st_intersects(temp_sf_p_hats_12,final_grid)
final_grid$p_hats<-rep(NA,nrow(final_grid))
final_grid$p_hats[unlist(temp_inter_12)]<-temp_sf_p_hats_12$p_hats
temp_pred_all_12<-predict(temp_pred_mod_12,final_grid)
temp_pred_all_12$split<-rep(splits,nrow(temp_pred_all_12))
#intersect
temp_inter_15<-st_intersects(temp_sf_p_hats_15,final_grid)
final_grid$p_hats<-rep(NA,nrow(final_grid))
final_grid$p_hats[unlist(temp_inter_15)]<-temp_sf_p_hats_15$p_hats
temp_pred_all_15<-predict(temp_pred_mod_15,final_grid)
temp_pred_all_15$split<-rep(splits,nrow(temp_pred_all_15))
#intersect
temp_inter_20<-st_intersects(temp_sf_p_hats_20,final_grid)
final_grid$p_hats<-rep(NA,nrow(final_grid))
final_grid$p_hats[unlist(temp_inter_20)]<-temp_sf_p_hats_20$p_hats
temp_pred_all_20<-predict(temp_pred_mod_20,final_grid)
temp_pred_all_20$split<-rep(splits,nrow(temp_pred_all_20))
if (splits==1){
pred_all_9_t<-temp_pred_all_9
pred_all_12_t<-temp_pred_all_12
pred_all_15_t<-temp_pred_all_15
pred_all_20_t<-temp_pred_all_20
} else {
pred_all_9_t<-rbind(pred_all_9_t,temp_pred_all_9)
pred_all_12_t<-rbind(pred_all_12_t,temp_pred_all_12)
pred_all_15_t<-rbind(pred_all_15_t,temp_pred_all_15)
pred_all_20_t<-rbind(pred_all_20_t,temp_pred_all_20)
}
}
year_groups <- c(
"1"="1997-1998",
"2"="1999-2000",
"3"="2001-2002"
)
interp_p_hats_9_t<-ggplot(pred_all_9_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 9 in different years")
ggsave(filename="reprod_contour_p_t_9.png",plot=interp_p_hats_9_t,width=12,height=9)
interp_p_hats_12_t<-ggplot(pred_all_12_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 12 in different years")
ggsave(filename="reprod_contour_p_t_12.png",plot=interp_p_hats_12_t,width=12,height=9)
interp_p_hats_15_t<-ggplot(pred_all_15_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 15 in different years")
ggsave(filename="reprod_contour_p_t_15.png",plot=interp_p_hats_15_t,width=12,height=9)
interp_p_hats_20_t<-ggplot(pred_all_20_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 20 in different years")
ggsave(filename="reprod_contour_p_t_20.png",plot=interp_p_hats_20_t,width=12,height=9)
head(pred_all_9_t)
head(subset(pred_all_9_t,split==1)$var1.pred-subset(pred_all_9_t,split==2)$var1.pred)
hist(subset(pred_all_9_t,split==1)$var1.pred-subset(pred_all_9_t,split==2)$var1.pred)
head(p_hats_t)
head(st_as_sf(subset(p_hats_t,type==9 & splits==splits),coords=c("x","y")))
splits
head(subset(p_hats_t,type==9 & splits==splits)
)
class(p_hats_t$splits)
for (splits in 1:3){
sub_temp_data<-subset(sub_data,split==splits)
sub_temp_data$spoligotype<-as.numeric(sub_temp_data$spoligotype)
sub_temp_data$spoligotype[which(sub_temp_data$spoligotype==9)]<-1
sub_temp_data$spoligotype[which(sub_temp_data$spoligotype==12)]<-2
sub_temp_data$spoligotype[which(sub_temp_data$spoligotype==15)]<-3
sub_temp_data$spoligotype[which(sub_temp_data$spoligotype==20)]<-4
blep3<-p_hats_int_fn(sub_locations,st_coordinates(sub_temp_data),sub_temp_data$spoligotype,6080)
temp_hats_t<-data.frame(x=rep(st_coordinates(sub_data)[,1],4),y=rep(st_coordinates(sub_data)[,2],4),splits=rep(splits,nrow(sub_data)*4),p_hats=c(blep3[,1],blep3[,2],blep3[,3],blep3[,4]),type=rep(as.character(c(9,12,15,20)),each=nrow(blep3)))
if (splits==1) p_hats_t<-temp_hats_t
else p_hats_t<-rbind(p_hats_t,temp_hats_t)
}
head(p_hats_t)
class(p_hats_t)
class(p_hats_t$splits)
head(subset(p_hats_t,(type==9 & splits==splits)))
unique(p_hats_t$splits)
which(p_hats_t$splits==1)
which(p_hats_t$splits==2)
dim(p_hats_t)
type==9 & splits==splits
type<-1
type==9 & splits==splits
head(subset(p_hats_t,type==9 & splits==splits))
dim(subset(p_hats_t,type==9 & splits==splits))
splits
dim(subset(subset(p_hats_t,type==9),  splits==splits),coords=c("x","y"))
dim(subset(subset(p_hats_t,type==9),  splits==splits))
head(subset(subset(p_hats_t,type==9),  splits==splits))
#Make sf frame
temp_sf_p_hats_9<-st_as_sf(subset(p_hats_t,type==9 &  splits==splits),coords=c("x","y"))
unique(temp_sf_p_hats_9$splits)
class(p_hats_t$splits)
head(subset(p_hats_t,type==9 &  splits==as.integer(splits)))
splits
which(p_hats_t$splits==splits)
which(p_hats_t$splits==splits & p_hats_t$type==9)
dim(temp_sf_p_hats_9)
dim(p_hats_t[which(p_hats_t$splits==splits & p_hats_t$type==9),])
head(p_hats_t[which(p_hats_t$splits==splits & p_hats_t$type==9),])
for (splits in 1:3){
#Make sf frame
temp_sf_p_hats_9<-st_as_sf(p_hats_t[which(p_hats_t$splits==splits & p_hats_t$type==9),],coords=c("x","y"))
temp_sf_p_hats_12<-st_as_sf(p_hats_t[which(p_hats_t$splits==splits & p_hats_t$type==12),],coords=c("x","y"))
temp_sf_p_hats_15<-st_as_sf(p_hats_t[which(p_hats_t$splits==splits & p_hats_t$type==15),],coords=c("x","y"))
temp_sf_p_hats_20<-st_as_sf(p_hats_t[which(p_hats_t$splits==splits & p_hats_t$type==20),],coords=c("x","y"))
temp_pred_mod_9<-gstat(formula=p_hats~1, data=temp_sf_p_hats_9)
temp_pred_mod_12<-gstat(formula=p_hats~1, data=temp_sf_p_hats_12)
temp_pred_mod_15<-gstat(formula=p_hats~1, data=temp_sf_p_hats_15)
temp_pred_mod_20<-gstat(formula=p_hats~1, data=temp_sf_p_hats_20)
#intersect
temp_inter_9<-st_intersects(temp_sf_p_hats_9,final_grid)
final_grid$p_hats<-rep(NA,nrow(final_grid))
final_grid$p_hats[unlist(temp_inter_9)]<-temp_sf_p_hats_9$p_hats
temp_pred_all_9<-predict(temp_pred_mod_9,final_grid)
temp_pred_all_9$split<-rep(splits,nrow(temp_pred_all_9))
#intersect
temp_inter_12<-st_intersects(temp_sf_p_hats_12,final_grid)
final_grid$p_hats<-rep(NA,nrow(final_grid))
final_grid$p_hats[unlist(temp_inter_12)]<-temp_sf_p_hats_12$p_hats
temp_pred_all_12<-predict(temp_pred_mod_12,final_grid)
temp_pred_all_12$split<-rep(splits,nrow(temp_pred_all_12))
#intersect
temp_inter_15<-st_intersects(temp_sf_p_hats_15,final_grid)
final_grid$p_hats<-rep(NA,nrow(final_grid))
final_grid$p_hats[unlist(temp_inter_15)]<-temp_sf_p_hats_15$p_hats
temp_pred_all_15<-predict(temp_pred_mod_15,final_grid)
temp_pred_all_15$split<-rep(splits,nrow(temp_pred_all_15))
#intersect
temp_inter_20<-st_intersects(temp_sf_p_hats_20,final_grid)
final_grid$p_hats<-rep(NA,nrow(final_grid))
final_grid$p_hats[unlist(temp_inter_20)]<-temp_sf_p_hats_20$p_hats
temp_pred_all_20<-predict(temp_pred_mod_20,final_grid)
temp_pred_all_20$split<-rep(splits,nrow(temp_pred_all_20))
if (splits==1){
pred_all_9_t<-temp_pred_all_9
pred_all_12_t<-temp_pred_all_12
pred_all_15_t<-temp_pred_all_15
pred_all_20_t<-temp_pred_all_20
} else {
pred_all_9_t<-rbind(pred_all_9_t,temp_pred_all_9)
pred_all_12_t<-rbind(pred_all_12_t,temp_pred_all_12)
pred_all_15_t<-rbind(pred_all_15_t,temp_pred_all_15)
pred_all_20_t<-rbind(pred_all_20_t,temp_pred_all_20)
}
}
year_groups <- c(
"1"="1997-1998",
"2"="1999-2000",
"3"="2001-2002"
)
interp_p_hats_9_t<-ggplot(pred_all_9_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 9 in different years")
ggsave(filename="reprod_contour_p_t_9.png",plot=interp_p_hats_9_t,width=12,height=9)
interp_p_hats_12_t<-ggplot(pred_all_12_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 12 in different years")
ggsave(filename="reprod_contour_p_t_12.png",plot=interp_p_hats_12_t,width=12,height=9)
interp_p_hats_15_t<-ggplot(pred_all_15_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 15 in different years")
ggsave(filename="reprod_contour_p_t_15.png",plot=interp_p_hats_15_t,width=12,height=9)
interp_p_hats_20_t<-ggplot(pred_all_20_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 20 in different years")
ggsave(filename="reprod_contour_p_t_20.png",plot=interp_p_hats_20_t,width=12,height=9)
interp_p_hats_20_t<-ggplot(pred_all_20_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 20 in different years",breaks=seq(0,1,by=0.2))
interp_p_hats_20_t
interp_p_hats_9_t<-ggplot(pred_all_9_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 9 in different years",breaks=seq(0,1,by=0.2))
ggsave(filename="reprod_contour_p_t_9.png",plot=interp_p_hats_9_t,width=12,height=9)
interp_p_hats_12_t<-ggplot(pred_all_12_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 12 in different years",breaks=seq(0,1,by=0.2))
ggsave(filename="reprod_contour_p_t_12.png",plot=interp_p_hats_12_t,width=12,height=9)
interp_p_hats_15_t<-ggplot(pred_all_15_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 15 in different years",breaks=seq(0,1,by=0.2))
ggsave(filename="reprod_contour_p_t_15.png",plot=interp_p_hats_15_t,width=12,height=9)
interp_p_hats_20_t<-ggplot(pred_all_20_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 20 in different years",breaks=seq(0,1,by=0.2))
ggsave(filename="reprod_contour_p_t_20.png",plot=interp_p_hats_20_t,width=12,height=9)
interp_p_hats_20_t<-ggplot(pred_all_20_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 20 in different years",limits=c(0,1))
interp_p_hats_20_t
interp_p_hats_12_t<-ggplot(pred_all_12_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 12 in different years",limits=c(0,1))
interp_p_hats_12_t
interp_p_hats_9_t<-ggplot(pred_all_9_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 9 in different years",limits=c(0,1))
ggsave(filename="reprod_contour_p_t_9.png",plot=interp_p_hats_9_t,width=12,height=9)
interp_p_hats_12_t<-ggplot(pred_all_12_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 12 in different years",limits=c(0,1))
ggsave(filename="reprod_contour_p_t_12.png",plot=interp_p_hats_12_t,width=12,height=9)
interp_p_hats_15_t<-ggplot(pred_all_15_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 15 in different years",limits=c(0,1))
ggsave(filename="reprod_contour_p_t_15.png",plot=interp_p_hats_15_t,width=12,height=9)
interp_p_hats_20_t<-ggplot(pred_all_20_t)+
geom_sf(aes(fill=var1.pred),col=NA)+
facet_wrap(~split,labeller=as_labeller(year_groups))+theme_bw()+
scale_fill_viridis_c(name="Estimated probabilities for \nspoligotype 20 in different years",limits=c(0,1))
ggsave(filename="reprod_contour_p_t_20.png",plot=interp_p_hats_20_t,width=12,height=9)
library(ggplot2)
library(sf)
library(dplyr)
nknot<-60
#Comparative qIs
# load("SEBDAM_BF_fit_60_knots.RData")
load("SEBDAM_BF_fit_60_knots_habitat_prior_converged2.RData")
sebdam_rep<-rep
sebdam_Report<-Report
sebdam_qIs<-data.frame(qI=rep$value[which(names(rep$value)=="qI")],
sd=rep$sd[which(names(rep$value)=="qI")],
source=rep("SEAM",60),
knotID=unique(obj$env$data$s_i))
load("manuscript_SEHBAM_fit2.RData")
sehbam_rep<-rep
sehbam_Report<-Report
sehbam_qIs<-data.frame(qI=rep$value[which(names(rep$value)=="qI")],
sd=rep$sd[which(names(rep$value)=="qI")],
source=rep("SEHBAM",60),
knotID=unique(obj$env$data$s_i))
all_qIs<-rbind(sebdam_qIs,sehbam_qIs)
#Means
mean(subset(all_qIs,source=="SEAM")$qI)
mean(subset(all_qIs,source=="SEHBAM")$qI)
length(which(sehbam_qIs$qI<sebdam_qIs$qI))/60
fig_dir<-"C:/Users/mcdonaldra/Documents/Github/SEHBAM-paper/Figures/"
jitter_guy<-position_jitter(width=0.5,seed=23)
qI_comp_plot<-ggplot(data=all_qIs,aes(x=knotID,y=qI,col=source,shape=source,
ymin=qI-sd,ymax=qI+sd))+
geom_point()+
geom_errorbar(width=0.65)+
geom_hline(aes(yintercept=0.3078),lty="twodash")+
geom_hline(aes(yintercept=mean(sebdam_qIs$qI)),col="red",lty="dashed")+
geom_hline(aes(yintercept=mean(sehbam_qIs$qI)),col="blue",lty="longdash")+
theme_bw()+
scale_color_manual(name="Model",values=c("red","blue"))+
scale_shape_discrete(name="Model")+
xlab("Knot")+ylab("Value")
# ggsave(filename=paste0(fig_dir,"qI_comp_plot.png"),
# plot=qI_comp_plot,height=8,width=10)
# ggsave(filename=paste0(fig_dir,"qI_comp_plot_supp.png"),
#        plot=qI_comp_plot,height=8,width=10)
# load("TLM_BF_fit_manuscript.RData")
load("TLM_BF_fit_manuscript_diff_prior2.RData")
tlm_rep<-rep
tlm_Report<-Report
NY<-length(tlm_Report$B)-1
#Total bio
bio_tots<-data.frame(tlm=tlm_Report$B,
sebdam=sebdam_Report$totB,
sehbam=sehbam_Report$totB,
tlm_se=tlm_rep$sd[which(names(tlm_rep$value)=="log_B")],
sebdam_se=sebdam_rep$sd[which(names(sebdam_rep$value)=="log_totB")],
sehbam_se=sehbam_rep$sd[which(names(sehbam_rep$value)=="log_totB")])
rec_tots<-data.frame(tlm=tlm_Report$R[-20],
sebdam=sebdam_Report$totR,
sehbam=sehbam_Report$totR,
tlm_se=tlm_rep$sd[which(names(tlm_rep$value)=="log_R")][-20],
sebdam_se=sebdam_rep$sd[which(names(sebdam_rep$value)=="log_totR")],
sehbam_se=sehbam_rep$sd[which(names(sehbam_rep$value)=="log_totR")])
m_tots<-data.frame(tlm=tlm_Report$m,
sebdam=sebdam_Report$mean_m,
sehbam=sehbam_Report$mean_m,
tlm_se=tlm_rep$sd[which(names(tlm_rep$value)=="log_m")],
sebdam_se=sebdam_rep$sd[which(names(sebdam_rep$value)=="log_mean_m")],
sehbam_se=sehbam_rep$sd[which(names(sehbam_rep$value)=="log_mean_m")])
setwd("./Github/SEHBAM-paper-scripts/")
#Plots from combining SEHBAM, TLM, and SEBDAM outputs
library(ggplot2)
library(sf)
library(dplyr)
nknot<-60
#Comparative qIs
# load("SEBDAM_BF_fit_60_knots.RData")
load("SEBDAM_BF_fit_60_knots_habitat_prior_converged2.RData")
sebdam_rep<-rep
sebdam_Report<-Report
sebdam_qIs<-data.frame(qI=rep$value[which(names(rep$value)=="qI")],
sd=rep$sd[which(names(rep$value)=="qI")],
source=rep("SEAM",60),
knotID=unique(obj$env$data$s_i))
load("manuscript_SEHBAM_fit2.RData")
sehbam_rep<-rep
sehbam_Report<-Report
sehbam_qIs<-data.frame(qI=rep$value[which(names(rep$value)=="qI")],
sd=rep$sd[which(names(rep$value)=="qI")],
source=rep("SEHBAM",60),
knotID=unique(obj$env$data$s_i))
all_qIs<-rbind(sebdam_qIs,sehbam_qIs)
#Means
mean(subset(all_qIs,source=="SEAM")$qI)
mean(subset(all_qIs,source=="SEHBAM")$qI)
length(which(sehbam_qIs$qI<sebdam_qIs$qI))/60
fig_dir<-"C:/Users/mcdonaldra/Documents/Github/SEHBAM-paper/Figures/"
jitter_guy<-position_jitter(width=0.5,seed=23)
qI_comp_plot<-ggplot(data=all_qIs,aes(x=knotID,y=qI,col=source,shape=source,
ymin=qI-sd,ymax=qI+sd))+
geom_point()+
geom_errorbar(width=0.65)+
geom_hline(aes(yintercept=0.3078),lty="twodash")+
geom_hline(aes(yintercept=mean(sebdam_qIs$qI)),col="red",lty="dashed")+
geom_hline(aes(yintercept=mean(sehbam_qIs$qI)),col="blue",lty="longdash")+
theme_bw()+
scale_color_manual(name="Model",values=c("red","blue"))+
scale_shape_discrete(name="Model")+
xlab("Knot")+ylab("Value")
# ggsave(filename=paste0(fig_dir,"qI_comp_plot.png"),
# plot=qI_comp_plot,height=8,width=10)
# ggsave(filename=paste0(fig_dir,"qI_comp_plot_supp.png"),
#        plot=qI_comp_plot,height=8,width=10)
# load("TLM_BF_fit_manuscript.RData")
load("TLM_BF_fit_manuscript_diff_prior2.RData")
tlm_rep<-rep
tlm_Report<-Report
NY<-length(tlm_Report$B)-1
#Total bio
bio_tots<-data.frame(tlm=tlm_Report$B,
sebdam=sebdam_Report$totB,
sehbam=sehbam_Report$totB,
tlm_se=tlm_rep$sd[which(names(tlm_rep$value)=="log_B")],
sebdam_se=sebdam_rep$sd[which(names(sebdam_rep$value)=="log_totB")],
sehbam_se=sehbam_rep$sd[which(names(sehbam_rep$value)=="log_totB")])
rec_tots<-data.frame(tlm=tlm_Report$R[-20],
sebdam=sebdam_Report$totR,
sehbam=sehbam_Report$totR,
tlm_se=tlm_rep$sd[which(names(tlm_rep$value)=="log_R")][-20],
sebdam_se=sebdam_rep$sd[which(names(sebdam_rep$value)=="log_totR")],
sehbam_se=sehbam_rep$sd[which(names(sehbam_rep$value)=="log_totR")])
m_tots<-data.frame(tlm=tlm_Report$m,
sebdam=sebdam_Report$mean_m,
sehbam=sehbam_Report$mean_m,
tlm_se=tlm_rep$sd[which(names(tlm_rep$value)=="log_m")],
sebdam_se=sebdam_rep$sd[which(names(sebdam_rep$value)=="log_mean_m")],
sehbam_se=sehbam_rep$sd[which(names(sehbam_rep$value)=="log_mean_m")])
tot_bio_plot<-ggplot(data=bio_tots[-20,])+
geom_point(aes(x=2001:2019,y=tlm,col="TLM",shape="TLM"),cex=2.25)+
geom_line(aes(x=2001:2019,y=tlm,col="TLM"))+
geom_ribbon(aes(x=2001:2019,ymax=exp(log(tlm)+2*tlm_se),
ymin=exp(log(tlm)-2*tlm_se),col="TLM",fill="TLM"),alpha=0.2)+
# geom_point(aes(x=2001:2019,y=sebdam,col="SEAM",shape="SEAM"),cex=2.25)+
# geom_line(aes(x=2001:2019,y=sebdam,col="SEAM"))+
# geom_ribbon(aes(x=2001:2019,ymax=exp(log(sebdam)+2*sebdam_se),
#                 ymin=exp(log(sebdam)-2*sebdam_se),col="SEAM",fill="SEAM"),alpha=0.2)+
geom_point(aes(x=2001:2019,y=sehbam,col="SEHBAM",shape="SEHBAM"),cex=2.25)+
geom_line(aes(x=2001:2019,y=sehbam,col="SEHBAM"))+
geom_ribbon(aes(x=2001:2019,ymax=exp(log(sehbam)+2*sehbam_se),
ymin=exp(log(sehbam)-2*sehbam_se),col="SEHBAM",fill="SEHBAM"),alpha=0.2)+
scale_fill_manual(name="Model",values=c("blue","orange"))+
scale_shape_discrete(name="Model")+
scale_color_manual(name="Model",values=c("blue","orange"))+
theme_bw()+xlab("Year")+ylab("Total Biomass (metric tonnes)")
tot_bio_plot
# ggsave(filename=paste0(fig_dir,"tot_B_plot.png"),
#        plot=tot_bio_plot,height=7,width=9)
ggsave(filename=paste0(fig_dir,"new_pres_tot_B_plot.png"),
plot=tot_bio_plot,height=7,width=9)
load("spat_plot_grids.RData")
temp_bio<-data.frame(knotID=rep(1:60,NY+1),
Year=rep(2001:2020,each=nknot),
B=as.vector(sehbam_Report$B))
Bio_spat<-left_join(temp_bio,gridded_bound_shape,by="knotID") %>% st_as_sf()
temp_rec<-data.frame(knotID=rep(1:60,NY),
Year=rep(2001:2019,each=nknot),
R=as.vector(sehbam_Report$R))
Rec_spat<-left_join(temp_rec,gridded_bound_shape,by="knotID") %>% st_as_sf()
temp_m<-data.frame(knotID=rep(1:60,NY+1),
Year=rep(2001:2020,each=nknot),
m=as.vector(sehbam_Report$m))
m_spat<-left_join(temp_m,gridded_bound_shape,by="knotID") %>% st_as_sf()
plot_map<-st_transform(sf_good_map,crs=32619)
plot_map$geometry<-plot_map$geometry/1000
st_crs(plot_map)<-NA
qI_comp_plot
all_qIs$knotID<-all_qIs$knotID+1
qIs_spat<-left_join(all_qIs,gridded_bound_shape,by="knotID",multiple="all") %>% st_as_sf()
spatial_qI_plot<-ggplot()+
geom_sf(data=qIs_spat,aes(fill=qI),col=NA)+
facet_wrap(~source)+
# scale_fill_distiller(name="Commercial Size \nCatchability",palette="Spectral")+
scale_fill_viridis_c(name="Commercial Size \nCatchability")+
geom_sf(data=plot_map)+theme_bw()+
coord_sf(xlim=c(690,890),ylim=c(4870,5080))+
xlab("Easting")+ylab("Northing")
spatial_qI_plot
head(qIs_spat)
length(which(qIs_spat$source=="SEAM"))
dim(qIs_spat)
qIs_spat$qI[which(qIs_spat$source=="SEAM")]<-rep(0.3,length(which(qIs_spat$source=="SEAM")))
spatial_qI_plot<-ggplot()+
geom_sf(data=qIs_spat,aes(fill=qI),col=NA)+
facet_wrap(~source)+
# scale_fill_distiller(name="Commercial Size \nCatchability",palette="Spectral")+
scale_fill_viridis_c(name="Commercial Size \nCatchability")+
geom_sf(data=plot_map)+theme_bw()+
coord_sf(xlim=c(690,890),ylim=c(4870,5080))+
xlab("Easting")+ylab("Northing")
spatial_qI_plot
# ggsave(filename=paste0(fig_dir,"spat_qI_plot.png"),
# plot=spatial_qI_plot,height=12,width=12)
ggsave(filename=paste0(fig_dir,"pres_weird_spat_qI_plot.png"),
plot=spatial_qI_plot,height=12,width=12)
qIs_spat$source[which(qIs_spat$source=="SEAM")]<-rep("Traditional",length(which(qIs_spat$source=="SEAM")))
spatial_qI_plot<-ggplot()+
geom_sf(data=qIs_spat,aes(fill=qI),col=NA)+
facet_wrap(~source)+
# scale_fill_distiller(name="Commercial Size \nCatchability",palette="Spectral")+
scale_fill_viridis_c(name="Commercial Size \nCatchability")+
geom_sf(data=plot_map)+theme_bw()+
coord_sf(xlim=c(690,890),ylim=c(4870,5080))+
xlab("Easting")+ylab("Northing")
spatial_qI_plot
# ggsave(filename=paste0(fig_dir,"spat_qI_plot.png"),
# plot=spatial_qI_plot,height=12,width=12)
ggsave(filename=paste0(fig_dir,"pres_weird_spat_qI_plot.png"),
plot=spatial_qI_plot,height=12,width=12)
